# API для сервиса справочников
Сервис справочников терминологии, который хранит коды данных и их контекст

## Как установить
Склонируйте репозиторий
```shell
git clone git@github.com:romses1906/RefbooksAPI.git
``` 
Перейдите в директорию проекта
```shell
cd RefbooksAPI
``` 

Создайте и активируйте виртуальное окружение Python
```shell
python -m venv venv

venv\Scripts\activate.bat - для Windows;

source venv/bin/activate - для Linux и MacOS.
``` 

Установите зависимости из файла requirements.txt
```shell
pip install -r requirements.txt
```

В корне проекта создайте файл .env и заполните его по примеру .env.template
```yaml
SECRET_KEY='секретный ключ Django'
```

Создайте и примените миграции
```shell
python manage.py makemigrations
python manage.py migrate
```

Создайте суперпользователя для доступа в административную панель
```shell
python manage.py createsuperuer
```
## Как запустить
Запуск сервера производится в активированном локальном окружение из папки `refbooks/`
```shell
python manage.py runserver 
```

Загрузка тестовых данных в существующие модели выполняется из папки `refbooks/` следующей командой:
```shell
python manage.py loaddata fixtures/*.json
```

Запуск тестов производится в активированном локальном окружение из папки `refbooks/`
```shell
python manage.py test
```

## Доступные АPI методы:

Доступны следующие API методы:

- Получение списка справочников (+ актуальных на указанную дату)
```yaml
Метод: refbooks/[?date=<date>]
Тип запроса HTTP: GET

Дата указывается опционально в формате ГГГГ-ММ-ДД
Если указана, то возвращаются только те справочники, в которых имеются версии с датой начала действия раннее или равной
указанной.

Пример запроса
GET /refbooks/?date=2022-10-01

Пример ответа
  {
    "refbooks": [
      {
        "id": "1",
        "code": "MS1",
        "name": " "
      },
      {
        "id": "2",
        "code": "ICD-10",
        "name": " -10"
      },
    ]
  }
```

- Получение элементов заданного справочника
```yaml
Метод: refbooks/<id>/elements[?version=<version>]
Тип запроса HTTP: GET

Версия справочника указывается опционально
Если не указана, то должны возвращаться элементы текущей версии.
Текущей является та версия, дата начала действия которой позже всех 
остальных версий данного справочника, но не позже текущей даты.

Пример запроса
GET /refbooks/1/elements?version=1.0

Пример ответа
  {
    "elements": [
      {
        "code": "J00",
        "value": " ()"
      },
      {
        "code": "J01",
        "value": " "
      }
    ]
  }
```
- Проверка, что элемент с данным кодом и значением присутствует в указанной версии справочника
```yaml
Метод: refbooks/<id>/check_element?code=<code>&value=<value>[&version=<version>]
Тип запроса HTTP: GET

Версия справочника указывается опционально
Если не указана, то должны возвращаться элементы текущей версии.

Пример запроса
GET /refbooks/1/check_element?code=С002&value=test_valueCOO2

Пример ответа
  {
    "result": true
  }
```

Доступ к документации проекта осуществляется по адресу:
```yaml
/schema/swagger
```

Доступ в административную панель с указанными при регистрации суперпользователя параметрами осуществляется по адресу:
```yaml
/admin
```
